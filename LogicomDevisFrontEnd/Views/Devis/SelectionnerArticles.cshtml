@model LogicomDevisFrontEnd.Models.Devis

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>

<html>
<head>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width" />
    <title>Selection des Articles</title>
  
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
        <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
    </svg>
    
   
</head>
<body>

    <center>
        <h2>Sélectionner les articles  </h2>
    </center>
    @if (Request.Browser.IsMobileDevice)
    {

        <a href="tel:@Model.client.tel1" class="bi bi-telephone">Appeler</a>
    }
    @using (Html.BeginForm())
    {<center>
            <table>
                <tr>
                    <td>
                        <table class="table">
                            <tr>
                                <th>
                                    Date:
                                </th>
                                <td>
                                    @Html.EditorFor(model => model.DATEBL, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    Numéro:
                                </th>
                                <td>
                                    @Html.EditorFor(model => model.NUMBL, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })

                                </td>
                            </tr>
                            <tr>
                                <th>
                                    PointVente:
                                </th>

                                <td>
                                    @Html.EditorFor(model => model.libpv, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })
                                </td>
                            </tr>

                        </table>
                    </td>
                    <td>
                        <table class="table">
                            <tr>
                                <th>
                                    Code client:
                                </th>
                                <td>
                                    @Html.EditorFor(model => model.client.code, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    Adresse:
                                </th>
                                <td>
                                    @Html.EditorFor(model => model.client.adresse, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })

                                </td>
                            </tr>
                            <tr>
                                <th>
                                    Raison sociale:
                                </th>

                                <td>
                                    @Html.EditorFor(model => model.RSCLI, new { htmlAttributes = new { @class = "form-control input-bordered", @readonly = "readonly" } })
                                </td>
                        </table>
                    </td>
                </tr>
            </table>






        </center>
        <div class="col-md-12">
            <table id="ExpTable" class="table table-sm table-striped" width="2000px"  >
                <thead>
                    <tr>

                        <th width="150px">
                            Depot
                        </th>
                        <th width="250px">
                            Famille
                        </th>
                        <th width="500px">
                            CodeArt
                        </th>
                        <th width="500px">
                            Designation
                        </th>
                        <th width="80px">
                            PUnitaire
                        </th>
                        <th width="50px">
                            TauxTVA(%)
                        </th>
                        <th width="80px">
                            Unité
                        </th>
                        <th width="130px">
                            Quantité
                        </th>
                        
                        <th width="60px">
                            Remise
                        </th>
                        
                        <th>
                            A/S
                        </th>
                        <th width="300px">
                            PHT
                        </th>
                        <th width="300px">
                            PTTC
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.LignesDevis.Count; i++)
                    {
                        <tr data-row-id="@i">
                            <td>
                                @Html.DropDownListFor(x => x.LignesDevis[i].codedep, ViewBag.codeDepot as SelectList, new { @class = "form-control input-bordered depot-select", data_row_index = i, width = "70" })
                                @*<select class="form-control input-bordered depot-select" value="@Model.LignesDevis[i].codedep"  name="LignesDevis[@i].codedep" data-row-index="@i" width="70" id="depot-select-@i" ></select>*@
                            </td>
                                    <td>
                                        <select class="form-control input-bordered famille-select" name="LignesDevis[@i].famille" data-row-index="@i" width="70" id="famille-select-@i" value="LignesDevis[@i].famille"></select>
                                    </td>
                                    <td>
                                        <select class="form-control input-bordered article-select" name="LignesDevis[@i].CodeART" data-row-index="@i" width="70" id="article-select-@i"></select>
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].DesART, new { htmlAttributes = new { @class = "form-control input-bordered desart-select", id = "desart-input", @readonly = "readonly" } })
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].PUART, new { htmlAttributes = new { @class = "form-control input-bordered puart-select", id = "puart-input", @readonly = "readonly" } })
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].TauxTVA, new { htmlAttributes = new { @class = "form-control input-bordered tva-select", id = "tauxtva-input", @readonly = "readonly" } })
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].Unite, new { htmlAttributes = new { @class = "form-control input-bordered unite-select" } })
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].QteART, new { htmlAttributes = new { @class = "form-control input-bordered qteart-select" } })


                                    </td>

                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].Remise, new { htmlAttributes = new { @class = "form-control input-bordered remise-select", id = "remise-input" } })
                                    </td>

                                    <td>
                                        <button id="btndummy-@i" type="button" class=" btn btn-sm invisible">Dummy</button>
                                        <button id="btnadd-@i" type="button"
                                                class="btn btn-sm btn-secondart visible" onclick="AddItem(this)">

                                            Add
                                        </button>
                                        <button id="btnremove-@i" type="button"
                                                class="btn btn-sm btn-danger invisible" onclick="DeleteItem(this)">

                                            Delete
                                        </button>
                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].mtht, new { htmlAttributes = new { @class = "form-control input-bordered pht-select", @readonly = "readonly" } })

                                    </td>
                                    <td>
                                        @Html.EditorFor(x => x.LignesDevis[i].mttc, new { htmlAttributes = new { @class = "form-control input-bordered pptc-select", @readonly = "readonly" } })

                                    </td>

                                </tr>
                            }
                        </tbody>

                    </table>
                    <div class="col-md-12">
                        <table id="ExpTable" class="table table-striped table-sm">
                            <thead>
                                <tr>

                                    <th>

                                    </th>
                                    <th>

                                    </th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th>
                                        Taux Remise
                                    </th>
                                    <th>
                                        Total Ht
                                    </th>
                                    <th>
                                        Total TTC
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>

                                        <input class="form-control input-bordered tauxRemise-Select" id="tauxRemise" width="70" name="TAUXREMISE" readonly="readonly" value="@Model.TAUXREMISE" />
                                    </td>
                                    <td>

                                        <input class="form-control input-bordered tauxht-Select" id="tauxht" width="70" name="MHT" readonly="readonly" value="@Model.MHT"  />
                                    </td>
                                    <td>
                                        <input class="form-control input-bordered tauxttc-Select" id="tauxttc" width="70" name="MTTC" readonly="readonly" value="@Model.MTTC" />
                                    </td>


                                </tr>
                            </tbody>



                        </table>
                    </div>
                </div>
                <input type="hidden" id="hdnLastIndex" value="0" />
                <div class="col-6 form-group text-left p-2">
                    <center> <input type="submit" value="Ajouter les articles" class="btn btn-default" /></center>
                </div>



            }
            @section Scripts{



                <script>
                    $(document).ready(function () {
                        // Récupérer le code Point de Vente du modèle
                        var codePV = "@Model.PointVente.Code";
                        // Définir l'URL de l'API pour récupérer les codes de dépôt
                        var apiUrl = "http://localhost:44333/api/Depot/DepotParCodePV?code=" + codePV;

                        // Effectuer la requête AJAX pour récupérer les codes de dépôt
                        $.ajax({
                            url: apiUrl,
                            type: "GET",
                            headers: { "Authorization":"Bearer "+@Session["token"] },
                            dataType: "json",
                            success: function (data) {



                                // Si la requête est réussie, ajouter chaque code dépôt à la liste déroulante
                                $(".depot-select").each(function () {
                                    var coded = $(this).val();
                                    if (coded == null || coded =="") {
                                        for (var i = 0; i < data.length; i++) {
                                            $(this).append("<option value='" + data[i].Code + "'>" + data[i].Code + "</option>");
                                        }
                                    }

                                });
                            }
                        }
                        );
                    },)




                </script>

                <script>
                   let rowIndex;
                $(document).on("change", ".depot-select", function () {
                    var codePV = "@Model.PointVente.Code";
                    var $row = $(this).closest("tr");
                    rowIndex = $(this).data("row-index");
                    var $familleSelect = $row.find(".famille-select");
                    var $articleSelect = $row.find(".article-select");
                    var codeDepot = $(this).val();
                    var qteart = $row.find(".qteart-select");


                    var $pht = $row.find(".pht-select");
                    var $pptc = $row.find(".pptc-select");
                    ///////
                    var $desArtSelect = $row.find(".desart-select");
                    var $puArtSelect = $row.find(".puart-select");
                    var $tauxTVAArtSelect = $row.find(".tva-select");
                    var $remiseArtSelect = $row.find(".remise-select");
                    var $prixNetArtSelect = $row.find(".mttc-select");







                //alert($(this).closest('tr').index());
                 var apiUrlFamille = "http://localhost:44333/api/LigneDepot/FetchLigneDepotParDepEtPv?codedep=" + codeDepot + "&codepv=" + codePV;
                $.ajax({
                    url: apiUrlFamille,
                    type: "GET",
                    headers: { "Authorization":"Bearer "+@Session["token"] },
                    dataType: "json",
                    success: function (data) {


                        $pht.val(0);
                        $pptc.val(0);
                        qteart.val(0);
                        /////
                        $desArtSelect.val("");
                        $puArtSelect.val(0);
                        $tauxTVAArtSelect.val(0);
                        $remiseArtSelect.val(0);
                        $prixNetArtSelect.val(0);
                        // Si la requête est réussie, vider la liste déroulante des familles et ajouter chaque famille distincte à la liste déroulante
                        $familleSelect.empty();
                        $(".famille-select").append("<option value=''>Sélectionner une famille </option>");
                        $articleSelect.empty();
                        var familles = [];
                        for (var i = 0; i < data.length; i++) {
                            if (!familles.includes(data[i].famille)) {
                                 if (!familles.includes(data[i].famille))
                                familles.push(data[i].famille);
                                $familleSelect.append("<option value='" + data[i].famille + "'>" + data[i].famille + "</option>");

                            }
                        }
                    },
                    error: function () {
                        // Si la requête échoue, afficher un message d'erreur
                        alert("Une erreur s'est produite lors de la récupération des familles d'articles.");
                    }
                });
            },);



                </script>



                <script>
             $(document).on("change", ".famille-select", function () {
            var $row = $(this).closest("tr");
            var famille = $(this).val();
            var codepv = "@Model.PointVente.Code";
            var codedep = $row.find(".depot-select").val();
                 var $articleSelect = $row.find(".article-select");
                 var qteart = $row.find(".qteart-select");

                 var $pht = $row.find(".pht-select");
                 var $pptc = $row.find(".pptc-select");
                 /////

                 var $desArtSelect = $row.find(".desart-select");
                 var $puArtSelect = $row.find(".puart-select");
                 var $tauxTVAArtSelect = $row.find(".tva-select");
                 var $remiseArtSelect = $row.find(".remise-select");
                 var $prixNetArtSelect = $row.find(".mttc-select");
                 /////
            $.ajax({
                type: "GET",
                headers: { "Authorization":"Bearer "+@Session["token"] },
                url: "http://localhost:44333/api/LigneDepot/FetchLigneDepotParDepEtPv?codedep=" + codedep + "&codepv=" + codepv,
                success: function (data) {
                    //alert (famille);
                    $articleSelect.empty();
                    qteart.val(0);


                    $pht.val(0);
                    $pptc.val(0);
                    ////////
                    $desArtSelect.val("");
                    $puArtSelect.val(0);
                    $tauxTVAArtSelect.val(0);
                    $remiseArtSelect.val(0);
                    $prixNetArtSelect.val(0);
                    var articles = [];
                    $(".article-select").append("<option value=''>Sélectionner un article </option>");
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].famille === famille && !articles.includes(data[i].codeart)) {

                            articles.push(data[i].famille);
                            $articleSelect.append("<option value='" + data[i].codeart + "'>" + data[i].codeart + "</option>");
                        }
                    }
                    //$("#desart-input").val($("#codeart-select option:selected").text());
                }
            });
        });



                </script>
                <script>
                    $(document).on("change", ".article-select", function () {
                        var $row = $(this).closest("tr");
                        var famille = $row.find(".famille-select").val();
                        var codeart = $(this).val();
                        var $qteart = $(".qteart-select");
                        var $pht = $row.find(".pht-select");
                        var $pptc = $row.find(".pptc-select");
                        var desArtSelect = $row.find(".desart-select");
                        var puArtSelect = $row.find(".puart-select");
                        var tauxTVAArtSelect = $row.find(".tva-select");
                        var remiseArtSelect = $row.find(".remise-select");
                        var prixNetArtSelect = $row.find(".mttc-select");
                        var $qteart = $row.find(".qteart-select");
                        //alert(famille);
                        //alert(codeart);
                        $.ajax({
                            type: "GET",
                            url: "http://localhost:44333/api/Article/FetchCodeArtEtFamille?codeart=" + codeart + "&fam=" + famille,
                            headers: { "Authorization":"Bearer "+@Session["token"] },
                            success: function (data) {
                                $qteart.val(0);

                                $pht.val(0);
                                $pptc.val(0);
                                $.each(data, function (index, item) {
                                    if (item.fam === famille && item.code === codeart) {
                                        desArtSelect.val(item.libelle);
                                        puArtSelect.val(item.prixbrut);
                                        tauxTVAArtSelect.val(item.tauxtva);
                                        //remiseArtSelect.val(item.DREMISE);
                                        prixNetArtSelect.val(item.prixnet);
                                    }
                                });

                            }
                        });
                    });
                </script>

                <script>
            $(document).on("change", ".qteart-select", function () {
                var $row = $(this).closest("tr");
                var qte = $(this).val();
                var codedep = $row.find(".depot-select").val();
                var codea = $row.find(".article-select").val();
                var famille = $row.find(".famille-select").val();
                var codepv = "@Model.PointVente.Code";
                var $qteart = $(this);
                var $pht = $row.find(".pht-select");
                var $pptc = $row.find(".pptc-select");
                var puArtSelect = $row.find(".puart-select").val();
                var remiseArtSelect = $row.find(".remise-select").val();
                var tauxTVAArtSelect = $row.find(".tva-select").val();
                var pht = $row.find(".pht-select").val();



                        if (parseFloat(qte) == 0) {
                            $pht.val(0);
                            $pptc.val(0);

                        }
                        if (parseFloat(qte) < 0) {
                            $qteart.val(0);
                            $pht.val(0);
                            $pptc.val(0);
                        }

                        if (parseFloat(remiseArtSelect) === 0 && parseFloat(qte) > 0) {
                            $pht.val((parseFloat(puArtSelect) * parseFloat(qte)));
                            if (parseFloat(tauxTVAArtSelect) == 0) {
                                $pptc.val(pht);

                            } else {
                                $pptc.val(parseFloat(puArtSelect) * parseFloat(qte) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                            }


                        }
                        if (parseFloat(remiseArtSelect) != 0 && parseFloat(qte) > 0 && parseFloat(tauxTVAArtSelect) != 0) {
                            $pht.val(puArtSelect * parseFloat(qte) * (1 - 0.01 * (parseFloat(remiseArtSelect))));
                            pht = $row.find(".pht-select").val();
                            $pptc.val(pht * (1 + 0.01 * (parseFloat(tauxTVAArtSelect))) * parseFloat(qte));



                        }
                        if (parseFloat(remiseArtSelect) != 0 && parseFloat(qte) > 0 && parseFloat(tauxTVAArtSelect) == 0) {

                            $pptc.val(parseFloat(pht) * parseFloat(qte));
                        }


            });
                </script>
                <script>
                    /* **************************************** ON CHANGE REMISE ******************************************** */
                    $(document).on("change", ".remise-select", function () {
                        var $row = $(this).closest("tr");
                        var qte = $row.find(".qteart-select").val();

                        var codea = $row.find(".article-select").val();
                        var famille = $row.find(".famille-select").val();
                        var codepv = "@Model.PointVente.Code";
                        var $remise = $(this);
                        var $pht = $row.find(".pht-select");
                        var $pptc = $row.find(".pptc-select");
                        var puArtSelect = $row.find(".puart-select").val();
                        var remise = $(this).val();
                        var t = -1;
                        var tauxTVAArtSelect = $row.find(".tva-select").val();


                        if (parseFloat(remise) < 0) {
                            $remise.val(0);
                            $pht.val(parseFloat(qte) * parseFloat(puArtSelect) * 1);
                            $pptc.val(parseFloat(qte) * parseFloat(puArtSelect) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                        }

                        $.ajax({
                            type: "GET",
                            headers: { "Authorization":"Bearer "+@Session["token"] },
                            url: "http://localhost:44333/api/Article/GetRemiseArticle?fam=" + famille + "&codeart=" + codea,
                            success: function (data) {
                                if (parseFloat(data) < parseFloat(remise) && parseFloat(qte)>0 ) {
                                    $remise.val(0);
                                    $pht.val(parseFloat(qte) * parseFloat(puArtSelect) * 1);
                                    $pptc.val(parseFloat(qte) * parseFloat(puArtSelect) * (1 + 0.01 * parseFloat(tauxTVAArtSelect) ));

                                    alert("Vous avez dépassé la marge de remise. Marge légale :  " + data);

                                }

                            }
                        });
                        if (   parseFloat(qte) > 0 ) {
                            $pht.val(parseFloat(qte) * parseFloat(puArtSelect) * (1 - 0.01 * parseFloat(remise)));
                            $pptc.val(parseFloat(qte) * parseFloat(puArtSelect) * (1 + 0.01 * parseFloat(tauxTVAArtSelect) - 0.01 * parseFloat(remise)));
                            t = 0;
                        }



                    });



                </script>

                <script>
                    /******************************************* CALCULER TOTAUX ***********************************/
                    $(document).on("change", ".qteart-select", function () {

                        var sumttc = 0;
                        var sumht = 0;
                        // Loop through all the pht-select fields and add up their values
                        $('.qteart-select').each(function () {
                            var $row = $(this).closest("tr");
                            var puArtSelect = $row.find(".puart-select").val();
                            var remiseArtSelect = $row.find(".remise-select").val();
                            var qte = $(this).val();
                            var tauxTVAArtSelect = $row.find(".tva-select").val();
                            if (parseFloat(qte)) {
                                sumht += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)));
                                sumttc += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                            }

                        });
                        document.getElementById("tauxht").value = sumht;
                        document.getElementById("tauxttc").value = sumttc;
                    });
                </script>
                <script>
                    $(document).on("change", ".remise-select", function () {

                        var sumttc = 0;
                        var sumht = 0;
                        var sumRemise = 0;
                        var nbrLignesTotal = document.getElementById("hdnLastIndex").value;
                        // Loop through all the pht-select fields and add up their values
                        $('.remise-select').each(function () {
                            var $row = $(this).closest("tr");
                            var puArtSelect = $row.find(".puart-select").val();
                            var qte = $row.find(".qteart-select").val();
                            var remiseArtSelect = $(this).val();
                            var tauxTVAArtSelect = $row.find(".tva-select").val();
                            if (parseFloat(qte)) {
                                sumht += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)));
                                sumttc += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                                sumRemise += parseFloat(remiseArtSelect);
                            }
                            document.getElementById("tauxht").value = sumht;
                            document.getElementById("tauxttc").value = sumttc;
                            document.getElementById("tauxRemise").value = (parseFloat(sumRemise) /( parseFloat(nbrLignesTotal)+1));



                        });
                    });
                </script>
                <script>
                            $(document).on("change", ".depot-select", function () {

                            var sumttc = 0;
                            var sumht = 0;
                            // Loop through all the pht-select fields and add up their values
                            $('.depot-select').each(function () {
                            var $row = $(this).closest("tr");
                            var puArtSelect = $row.find(".puart-select").val();
                            var qte = $row.find(".qteart-select").val();
                            var remiseArtSelect = $row.find(".remise-select").val();
                            var tauxTVAArtSelect = $row.find(".tva-select").val();
                                if (parseFloat(qte)) {
                                    sumht += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)));
                                    sumttc += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                                }


                            });

                            // Display the sum in the tauxht-Select field
                            document.getElementById("tauxht").value = sumht;
                            document.getElementById("tauxttc").value = sumttc;
                            });
                </script>
                <script>
                                /*****************Famille**********************/
                                $(document).on("change", ".famille-select", function () {

                                    var sumttc = 0;
                                var sumht = 0;

                                $('.famille-select').each(function () {
                                var $row = $(this).closest("tr");
                                var puArtSelect = $row.find(".puart-select").val();
                                var qte = $row.find(".qteart-select").val();
                                var remiseArtSelect = $row.find(".remise-select").val();
                                var tauxTVAArtSelect = $row.find(".tva-select").val();
                                if (parseFloat(qte)) {
                                 sumht += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)));
                                sumttc += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                                 }

                                 });


                                document.getElementById("tauxht").value = sumht;
                                    document.getElementById("tauxttc").value = sumttc;

                                });
                </script>
                <script>
                        /*****************article**********************/
                        $(document).on("change", ".article-select", function () {
                            var sumttc = 0;
                            var sumht = 0;
                            $('.article-select').each(function () {
                                var $row = $(this).closest("tr");
                                var puArtSelect = $row.find(".puart-select").val();
                                var qte = $row.find(".qteart-select").val();
                                var remiseArtSelect = $row.find(".remise-select").val();
                                var tauxTVAArtSelect = $row.find(".tva-select").val();
                                if (parseFloat(qte)) {
                                    sumht += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)));
                                    sumttc += (parseFloat(puArtSelect) * parseFloat(qte) * (1 - 0.01 * parseFloat(remiseArtSelect)) * (1 + 0.01 * parseFloat(tauxTVAArtSelect)));
                                }
                            });
                            document.getElementById("tauxht").value = sumht;
                            document.getElementById("tauxttc").value = sumttc;

                        });


                </script>
                <script type="text/javascript">
                    $(".custom-file-input").on("change", function () {
                        var fileName = $(this).val().split("\\").pop();
                        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                    });



                    function DeleteItem(btn) {
                        $(btn).closest('tr').remove();
                    }



                    function AddItem(btn) {

                        var table = document.getElementById('ExpTable');
                        var rows = table.getElementsByTagName('tr');

                        var rowOuterHtml = rows[rows.length - 1].outerHTML;

                        var lastrowIdx = document.getElementById('hdnLastIndex').value;

                        var nextrowIdx = eval(lastrowIdx) + 1;

                        document.getElementById('hdnLastIndex').value = nextrowIdx;

                        rowOuterHtml = rowOuterHtml.replaceAll('_' + lastrowIdx + '_', '_' + nextrowIdx + '_');
                        rowOuterHtml = rowOuterHtml.replaceAll('[' + lastrowIdx + ']', '[' + nextrowIdx + ']');
                        rowOuterHtml = rowOuterHtml.replaceAll('-' + lastrowIdx, '-' + nextrowIdx);


                        var newRow = table.insertRow();
                        newRow.innerHTML = rowOuterHtml;



                        var btnAddID = btn.id;
                        var btnDeleteid = btnAddID.replaceAll('btnadd', 'btnremove');

                        var delbtn = document.getElementById(btnDeleteid);
                        delbtn.classList.add("visible");
                        delbtn.classList.remove("invisible");


                        var addbtn = document.getElementById(btnAddID);
                        addbtn.classList.remove("visible");
                        addbtn.classList.add("invisible");



                    }

                </script>




            }
        </body>
        </html>
